<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= movie.title %> - CineAI</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
</head>
<body>

    <!-- NAVBAR (T√ºm sayfalarda standart) -->
    <%- include('partials/navbar') %>

    <div class="main-container" style="margin-top: 40px;">
        
        <!-- SOL TARAF: ƒ∞√áERƒ∞K -->
        <section class="content-area">
            
            <%- include('partials/breadcrumbs') %>

            <!-- Fƒ∞LM DETAY KARTI -->
            <div class="movie-hero detail-view">
                <div class="poster-wrapper">
                    <img src="<%= movie.posterUrl %>" alt="<%= movie.title %>">
                </div>
                <div class="movie-info">
                    <h1><%= movie.title %></h1>
                    
                    <div class="tags-container">
                        <a href="/genre/<%= movie.genre ? movie.genre.split(',')[0] : '' %>" class="genre-tag">
                            <%= movie.genre ? movie.genre.split(',')[0] : 'Genel' %>
                        </a>
                        <% if(movie.tags) { %>
                            <% movie.tags.forEach(tag => { %>
                                <span class="hashtag">#<%= tag %></span>
                            <% }) %>
                        <% } %>
                    </div>

                    <ul class="meta-list">
                        <li><i class="fa-regular fa-calendar"></i> <%= movie.year %></li>
                        <li><i class="fa-regular fa-clock"></i> <%= movie.duration %> dk</li>
                        
                        <!-- Y√ñNETMEN -->
                        <li class="actors-info">
                            <i class="fa-solid fa-clapperboard"></i> 
                            <strong>Y√∂netmen:</strong> 
                            <% if (movie.director) { %>
                                <!-- G√úNCELLEME: Linkin sonuna film bilgisini ekledik -->
                                <a href="/director/<%= movie.director.trim() %>?fromMovie=<%= encodeURIComponent(movie.title) %>&fromId=<%= movie._id %>" class="actor-link">
                                    <%= movie.director %>
                                </a>
                            <% } else { %>
                                Belirtilmemi≈ü
                            <% } %>
                        </li>

                        <!-- OYUNCULAR -->
                        <li class="actors-info">
                            <i class="fa-solid fa-user-group"></i> 
                            <strong>Oyuncular:</strong> 
                            <% if (movie.actors) { %>
                                <% movie.actors.split(',').forEach((actor, index) => { %>
                                    <!-- G√úNCELLEME: Linkin sonuna film bilgisini ekledik -->
                                    <a href="/actor/<%= actor.trim() %>?fromMovie=<%= encodeURIComponent(movie.title) %>&fromId=<%= movie._id %>" class="actor-link">
                                        <%= actor.trim() %>
                                    </a>
                                    <%= index < movie.actors.split(',').length - 1 ? ',' : '' %>
                                <% }) %>
                            <% } %>
                        </li>
                    </ul>

                    <p class="summary"><%= movie.summary %></p>
                    <!-- YENƒ∞: AI VIBE CHECK KUTUSU -->
                    <% if (movie.vibe && movie.vibe.watch_if) { %>
                    <div class="ai-vibe-box">
                        <div class="vibe-header">
                            <i class="fa-solid fa-robot"></i> <span>AI Vibe Check</span>
                        </div>
                        <div class="vibe-grid">
                            <div class="vibe-item positive">
                                <i class="fa-solid fa-check-circle"></i>
                                <div>
                                    <strong>Bunu ƒ∞zle:</strong>
                                    <p><%= movie.vibe.watch_if %></p>
                                </div>
                            </div>
                            <div class="vibe-item negative">
                                <i class="fa-solid fa-circle-xmark"></i>
                                <div>
                                    <strong>Pas Ge√ß:</strong>
                                    <p><%= movie.vibe.skip_if %></p>
                                </div>
                            </div>
                            <div class="vibe-item atmosphere">
                                <i class="fa-solid fa-wind"></i>
                                <div>
                                    <strong>Atmosfer:</strong>
                                    <p><%= movie.vibe.atmosphere %></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>
                    <div class="action-buttons">
                        <form action="/like/<%= movie._id %>" method="POST">
                            <button class="btn-like">‚ù§Ô∏è Beƒüen (<%= movie.likes %>)</button>
                        </form>
                        <div class="action-buttons">
    <form action="/like/<%= movie._id %>" method="POST">
        <button class="btn-like">‚ù§Ô∏è Beƒüen (<%= movie.likes %>)</button>
    </form>
    
    <!-- YENƒ∞ KAYDET BUTONU -->
    <button class="btn-save btn-watchlist" data-id="<%= movie._id %>" onclick="toggleWatchlist('<%= movie._id %>', this)">
        <i class="fa-regular fa-bookmark"></i> Listeme Ekle
    </button>
</div>
                    </div>
                </div>
            </div>

            <!-- YORUMLAR -->
            <div class="comments-container">
                <h3>üí¨ Yorumlar</h3>
                <form action="/comment/<%= movie._id %>" method="POST" class="comment-form">
                    <input type="text" name="username" placeholder="Adƒ±nƒ±z" required>
                    <select name="rating">
                        <option value="10">10/10 - M√ºkemmel</option>
                        <option value="9">9/10 - √áok ƒ∞yi</option>
                        <option value="8">8/10 - ƒ∞yi</option>
                        <option value="5">5/10 - Ortalama</option>
                    </select>
                    <textarea name="text" placeholder="Yorumunuz..." required></textarea>
                    <button type="submit">G√∂nder</button>
                </form>
                <% movie.comments.reverse().forEach(c => { %>
                    <div class="comment-card">
                        <div class="c-head">
                            <strong><%= c.username %></strong>
                            <span>‚≠ê <%= c.rating %>/10</span>
                        </div>
                        <p><%= c.text %></p>
                    </div>
                <% }) %>
            </div>

            <!-- BENZER Fƒ∞LMLER (ARTIK YORUMLARIN ALTINDA) -->
            <% if (similarMovies && similarMovies.length > 0) { %>
            <div class="similar-movies-section">
                <h3><i class="fa-solid fa-thumbs-up"></i> Bunlarƒ± da Sevebilirsin</h3>
                <div class="similar-grid">
                    <% similarMovies.forEach(sim => { %>
                        <a href="/movie/<%= sim._id %>" class="similar-card">
                            <img src="<%= sim.posterUrl %>" alt="<%= sim.title %>">
                            <div class="sim-info">
                                <h4><%= sim.title %></h4>
                                <span><%= sim.year %></span>
                            </div>
                        </a>
                    <% }) %>
                </div>
            </div>
            <% } %>

        </section>

        <!-- SAƒû TARAF: SIDEBAR -->
        <%- include('partials/sidebar') %>

    </div>

    <!-- FOOTER (T√ºm sayfalarda standart) -->
    <%- include('partials/footer') %>

</body>
</html>